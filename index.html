<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weather Dashboard (Tailwind)</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Tailwind config to add the custom colors from your CSS
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'ios-top': '#4facfe',
            'ios-bottom': '#00f2fe',
            'glass-card': 'rgba(255,255,255,0.25)',
            'glass-weak': 'rgba(255,255,255,0.20)',
            'glass-border': 'rgba(255,255,255,0.35)',
          },
          borderRadius: {
            'xl2': '20px'
          },
          boxShadow: {
            'soft-lg': '0 8px 30px rgba(0,0,0,0.15)',
            'logo': '0 6px 18px rgba(0,0,0,0.2)'
          }
        }
      }
    }
  </script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Work+Sans:wght@400;600&display=swap" rel="stylesheet">

  <style>
    /* small helpers for leftover bits */
    html,body{height:100%}
    body{font-family: 'Work Sans', Inter, system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;}
    /* ensure suggestion list sits above other UI */
    .suggest-list { z-index: 60; }
    /* optional tiny transition for the unit labels */
    .unit-label { transition: all 0.14s ease; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-ios-top to-ios-bottom text-white antialiased">

  <div class="max-w-[980px] mx-auto p-7 md:p-8">
    <header class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4">
      <div class="flex items-center gap-3">
        <div class="w-11 h-11 rounded-xl bg-white/90 text-[#007aff] flex items-center justify-center font-extrabold shadow-logo">
          W
        </div>
        <div>
          <h1 class="text-lg font-semibold">Weather Dashboard</h1>
          <small class="text-white/85 text-xs block">Live weather • 5-day forecast • Offline-ready</small>
        </div>
      </div>

      <div class="flex items-center gap-2 ml-auto">
        <button id="geoBtn" class="rounded-lg border border-white/60 text-white text-sm px-3 py-1.5">Use My Location</button>

        <!-- Units: modified to include container + label classes -->
        <div id="unitToggle" class="inline-flex rounded-lg overflow-hidden border border-white/60 ml-2" role="group" aria-label="Units">
          <!-- hidden radios -->
          <input type="radio" class="hidden" name="units" id="unitMetric" value="metric" />
          <label id="labelMetric" for="unitMetric" class="unit-label text-white text-sm px-3 py-1.5 cursor-pointer select-none">°C</label>

          <input type="radio" class="hidden" name="units" id="unitImperial" value="imperial" />
          <label id="labelImperial" for="unitImperial" class="unit-label text-white text-sm px-3 py-1.5 cursor-pointer select-none">°F</label>
        </div>
      </div>
    </header>

    <!-- panel -->
    <section class="bg-[rgba(255,255,255,0.25)] border border-[rgba(255,255,255,0.35)] rounded-xl2 p-5 shadow-soft-lg backdrop-blur-xl">
      <form id="searchForm" class="flex flex-col md:flex-row gap-3 items-center">
        <div class="relative flex-1 w-full suggestions">
          <input id="cityInput" type="text" placeholder="Search city (e.g., Surat, IN)" autocomplete="off" required
            class="w-full bg-white/20 border border-white/40 rounded-lg px-4 py-3 text-white placeholder-white/70 outline-none focus:ring-0 focus:shadow-[0_6px_18px_rgba(0,122,255,0.12)]" />
          <div id="suggestList" class="suggest-list hidden absolute left-0 right-0 mt-2 max-h-64 overflow-auto rounded-lg bg-white/92 border border-black/8 p-1 backdrop-blur-md shadow-md"></div>
        </div>

        <div class="w-full md:w-[140px]">
          <button id="searchBtn" class="w-full bg-white/90 text-[#007aff] font-semibold py-3 rounded-lg shadow-md">Search</button>
        </div>
      </form>

      <div id="status" class="text-yellow-400 text-sm mt-2"></div>

      <div class="flex items-center justify-between mt-4">
        <div class="text-sm text-white/80">Recent searches</div>
        <div id="recentChips" class="recent-chips"></div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-[1fr_320px] gap-4 mt-4 items-start">
        <!-- current -->
        <div id="current" class="bg-[rgba(255,255,255,0.25)] border border-[rgba(255,255,255,0.35)] rounded-lg p-5 backdrop-blur-lg shadow-soft-lg">
          <div class="flex items-start justify-between">
            <div>
              <div id="cityName" class="text-lg font-semibold">—</div>
              <div id="dateStr" class="text-sm text-white/80 mt-1">—</div>
            </div>
            <img id="currIcon" alt="icon" class="w-20 h-20 filter drop-shadow-[0_8px_28px_rgba(0,0,0,0.25)]" />
          </div>

          <div id="temp" class="text-4xl font-extrabold mt-3">—</div>
          <div id="desc" class="capitalize text-white/80 mt-1">—</div>

          <div class="flex flex-wrap gap-3 mt-3">
            <div class="bg-white/20 border border-white/30 text-black font-semibold rounded-lg px-3 py-2">Humidity: <span id="humidity">—</span>%</div>
            <div class="bg-white/20 border border-white/30 text-black font-semibold rounded-lg px-3 py-2">Wind: <span id="wind">—</span></div>
            <div class="bg-white/20 border border-white/30 text-black font-semibold rounded-lg px-3 py-2">Feels like: <span id="feels">—</span></div>
            <div class="bg-white/20 border border-white/30 text-black font-semibold rounded-lg px-3 py-2">Pressure: <span id="pressure">—</span> hPa</div>
          </div>
        </div>

        <!-- forecast panel -->
        <div class="bg-[rgba(255,255,255,0.25)] border border-[rgba(255,255,255,0.35)] rounded-xl2 p-5 backdrop-blur-lg shadow-soft-lg">
          <h4 class="text-black font-semibold mb-2">5-Day Forecast</h4>
          <div id="forecastRow" class="flex gap-3 overflow-auto pt-2"></div>
        </div>
      </div>
    </section>

    <footer class="text-center text-white/80 text-sm mt-4">
      Built with <a href="https://openweathermap.org/" target="_blank" rel="noreferrer" class="underline">OpenWeatherMap</a> • Deploy on Azure Static Web Apps
    </footer>
  </div>

  <div id="toastWrap" class="fixed top-4 right-4 z-50"></div>

  <!-- JS: adapted to toggle unit UI -->
  <script>
    // ====== CONFIG ======
    const API_KEY = "1712a07d62bbfafc884061843bb3e5ff"; // Replace with your key
    const state = { units: 'metric', fetching: false };

    // ====== HELPERS ======
    const $ = (s) => document.querySelector(s);
    const statusEl = $('#status');
    const searchBtn = $('#searchBtn');
    const suggestList = $('#suggestList');

    function showStatus(msg, loading=false){ statusEl.innerHTML = loading ? `<span class="loader inline-block w-4 h-4 border-2 border-white/40 border-t-white rounded-full animate-spin mr-2 align-middle"></span>${msg}` : msg; }
    function showToast(msg, variant='light'){ const id='t'+Date.now(); const el=document.createElement('div'); el.className=`toast mb-2 p-3 rounded-md bg-white/90 text-black shadow-md`; el.innerHTML=`<div class="text-sm">${msg}</div>`; document.getElementById('toastWrap').appendChild(el); setTimeout(()=>el.remove(),4500); }

    function fmtTemp(t){return `${Math.round(t)}°${state.units==='metric'?'C':'F'}`}
    function fmtWind(s){return state.units==='metric' ? `${(s*3.6).toFixed(1)} km/h` : `${s.toFixed(1)} mph`}
    function iconUrl(code){return `https://openweathermap.org/img/wn/${code}@2x.png`}

    // ====== STORAGE ======
    function saveRecent(city){ try{ let arr=JSON.parse(localStorage.getItem('recentCities')||'[]'); arr=arr.filter(x=>x!==city); arr.unshift(city); if(arr.length>5) arr.pop(); localStorage.setItem('recentCities', JSON.stringify(arr)); renderRecent(); }catch(e){} }
    function renderRecent(){ const wrap = document.getElementById('recentChips'); wrap.innerHTML=''; const arr = JSON.parse(localStorage.getItem('recentCities')||'[]'); if(arr.length===0){ wrap.innerHTML='<span class="text-white/70">—</span>'; return; } arr.forEach(c=>{ const b=document.createElement('button'); b.className='text-sm mr-2 mb-2 px-3 py-1 rounded-full border border-white/40 text-white/90 bg-white/5'; b.textContent=c; b.onclick=()=>{ $('#cityInput').value=c; fetchWeatherByCity(c).catch(e=>showToast(e.message,'danger')); }; wrap.appendChild(b); }); }

    // ====== DEBOUNCE ======
    function debounce(fn, wait=300){ let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), wait); } }

    // ====== SUGGESTIONS ======
    async function fetchSuggestions(q){ if(!q||q.trim().length<2){ suggestList.classList.add('hidden'); return; } const url=`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(q)}&limit=6&appid=${API_KEY}`; try{ const res=await fetch(url); if(res.status===401) throw new Error('Invalid API key'); const data=await res.json(); if(!Array.isArray(data)||data.length===0){ suggestList.classList.add('hidden'); return; } suggestList.innerHTML = data.map(item=>{ const nameParts=[item.name,item.state,item.country].filter(Boolean).join(', '); return `<div class="py-2 px-3 rounded-md hover:bg-black/6 cursor-pointer flex justify-between items-center" data-lat="${item.lat}" data-lon="${item.lon}" data-name="${nameParts}"><span class="text-sm text-black font-semibold">${nameParts}</span><small class="text-xs text-black/70">${item.lat.toFixed(2)}, ${item.lon.toFixed(2)}</small></div>`; }).join(''); suggestList.classList.remove('hidden'); }catch(err){ console.error(err); suggestList.classList.add('hidden'); } }
    const debFetchSuggestions = debounce((v)=>fetchSuggestions(v),250);
    suggestList.addEventListener('click', (e)=>{ const it = e.target.closest('[data-name]'); if(!it) return; const name = it.dataset.name; $('#cityInput').value = name; suggestList.classList.add('hidden'); fetchWeatherByCity(name).catch(err=>showToast(err.message,'danger')); });
    document.addEventListener('click', (e)=>{ if(!e.target.closest('.suggestions')) suggestList.classList.add('hidden'); });
    $('#cityInput').addEventListener('input', (e)=>{ debFetchSuggestions(e.target.value); });

    // ====== API CALLS ======
    async function fetchWeatherByCity(city){ if(state.fetching) return; state.fetching=true; toggleLoading(true); const base='https://api.openweathermap.org/'; const q=encodeURIComponent(city); try{ showStatus('Finding city…', true); const geoUrl = `${base}geo/1.0/direct?q=${q}&limit=1&appid=${API_KEY}`; const geoRes = await fetch(geoUrl); if(geoRes.status===401) throw new Error('Invalid API key'); const geo = await geoRes.json(); if(!Array.isArray(geo)||geo.length===0) throw new Error('City not found. Try "Surat, IN"'); const { lat, lon, name, country, state: region } = geo[0]; showStatus('Fetching weather…', true); const u = state.units; const currUrl = `${base}data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=${u}`; const foreUrl = `${base}data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=${u}`; const [currRes, foreRes] = await Promise.all([fetch(currUrl), fetch(foreUrl)]); if(currRes.status===401) throw new Error('Invalid API key'); if(!currRes.ok) throw new Error('Weather not available for this location'); const curr = await currRes.json(); const fore = await foreRes.json(); const displayName = [name, region, country].filter(Boolean).join(', '); localStorage.setItem('lastCity', displayName); renderCurrent({ ...curr, name: displayName }); renderForecast(fore); saveRecent(displayName); showStatus(''); }catch(err){ console.error(err); showStatus(''); showToast(err.message || 'Something went wrong', 'danger'); throw err; }finally{ state.fetching=false; toggleLoading(false); } }

    async function fetchWeatherByCoords(lat, lon){ if(state.fetching) return; state.fetching=true; toggleLoading(true); try{ showStatus('Fetching weather for your location…', true); const base='https://api.openweathermap.org/'; const u = state.units; const currUrl = `${base}data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=${u}`; const foreUrl = `${base}data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=${u}`; const [currRes, foreRes] = await Promise.all([fetch(currUrl), fetch(foreUrl)]); if(currRes.status===401) throw new Error('Invalid API key'); if(!currRes.ok) throw new Error('Weather not available for this location'); const curr = await currRes.json(); const fore = await foreRes.json(); const displayName = `${curr.name}, ${curr.sys.country}`; localStorage.setItem('lastCity', displayName); renderCurrent({ ...curr, name: displayName }); renderForecast(fore); saveRecent(displayName); showStatus(''); }catch(err){ console.error(err); showStatus(''); showToast(err.message || 'Something went wrong', 'danger'); }finally{ state.fetching=false; toggleLoading(false); } }

    // ====== RENDER ======
    function renderCurrent(d){ $('#current').classList.remove('d-none'); $('#cityName').textContent = `${d.name}`; $('#dateStr').textContent = new Date(d.dt*1000).toLocaleString(); $('#currIcon').src = iconUrl(d.weather[0].icon); $('#currIcon').alt = d.weather[0].description; $('#temp').textContent = fmtTemp(d.main.temp); $('#desc').textContent = d.weather[0].description; $('#humidity').textContent = d.main.humidity; $('#wind').textContent = fmtWind(d.wind.speed); $('#feels').textContent = fmtTemp(d.main.feels_like); $('#pressure').textContent = d.main.pressure; }

    function renderForecast(f){ $('#forecastRow').classList.remove('d-none'); const row = $('#forecastRow'); row.innerHTML = ''; const items = f.list.filter(x=>x.dt_txt.includes('12:00:00')); items.forEach((x)=>{ const el = document.createElement('div'); el.className = 'min-w-[132px] p-3 rounded-lg border border-[rgba(255,255,255,0.27)] bg-white/25 text-black backdrop-blur-md flex flex-col items-center gap-2'; el.innerHTML = `<div class="font-semibold text-sm">${new Date(x.dt*1000).toLocaleDateString(undefined,{weekday:'short', month:'short', day:'numeric'})}</div><img class="icon" src="${iconUrl(x.weather[0].icon)}" alt="${x.weather[0].description}" style="width:56px;height:56px"><div class="text-sm text-black/70 capitalize">${x.weather[0].description}</div><div class="font-bold mt-1">${fmtTemp(x.main.temp)}</div><div class="text-sm text-black/70">H: ${fmtTemp(x.main.temp_max)} · L: ${fmtTemp(x.main.temp_min)}</div>`; row.appendChild(el); }); }

    // ====== UI STATE ======
    function toggleLoading(isLoading){ if(isLoading){ searchBtn.disabled=true; searchBtn.innerHTML=`<span class="inline-block w-4 h-4 border-2 border-white/40 border-t-white rounded-full animate-spin mr-2 align-middle"></span>Loading...`; } else { searchBtn.disabled=false; searchBtn.textContent='Search'; } }

    // ====== UNIT TOGGLE UI ======
    const labelMetric = document.getElementById('labelMetric');
    const labelImperial = document.getElementById('labelImperial');
    const inputMetric = document.getElementById('unitMetric');
    const inputImperial = document.getElementById('unitImperial');

    function applyUnitUI(selected) {
      // Clear both
      labelMetric.classList.remove('bg-white','text-[#007aff]','font-semibold');
      labelImperial.classList.remove('bg-white','text-[#007aff]','font-semibold');
      labelMetric.classList.add('text-white');
      labelImperial.classList.add('text-white');

      // Apply active style to selected
      if (selected === 'metric') {
        labelMetric.classList.remove('text-white');
        labelMetric.classList.add('bg-white','text-[#007aff]','font-semibold');
        inputMetric.checked = true;
      } else {
        labelImperial.classList.remove('text-white');
        labelImperial.classList.add('bg-white','text-[#007aff]','font-semibold');
        inputImperial.checked = true;
      }
    }

    // Hook up radio change events (this covers keyboard + programmatic changes)
    inputMetric.addEventListener('change', () => {
      if (inputMetric.checked) {
        state.units = 'metric';
        localStorage.setItem('units','metric');
        applyUnitUI('metric');
        const last = localStorage.getItem('lastCity'); if (last) fetchWeatherByCity(last).catch(()=>{});
      }
    });
    inputImperial.addEventListener('change', () => {
      if (inputImperial.checked) {
        state.units = 'imperial';
        localStorage.setItem('units','imperial');
        applyUnitUI('imperial');
        const last = localStorage.getItem('lastCity'); if (last) fetchWeatherByCity(last).catch(()=>{});
      }
    });

    // Also handle label clicks (some browsers/edge-cases): force radio + fire change handler
    labelMetric.addEventListener('click', (e) => {
      e.preventDefault();
      inputMetric.checked = true;
      inputMetric.dispatchEvent(new Event('change', { bubbles: true }));
    });
    labelImperial.addEventListener('click', (e) => {
      e.preventDefault();
      inputImperial.checked = true;
      inputImperial.dispatchEvent(new Event('change', { bubbles: true }));
    });

    // ====== EVENTS ======
    $('#searchForm').addEventListener('submit', (e)=>{ e.preventDefault(); const city = $('#cityInput').value.trim(); if(!city) return showToast('Please enter a city name','warning'); fetchWeatherByCity(city).catch(()=>{}); });
    $('#geoBtn').addEventListener('click', ()=>{ if(!navigator.geolocation){ showToast('Geolocation not supported','warning'); return; } navigator.geolocation.getCurrentPosition((pos)=>{ fetchWeatherByCoords(pos.coords.latitude, pos.coords.longitude); }, (err)=>{ showToast('Location permission denied','warning'); }); });

    // ====== INIT ======
    (function init(){
      // restore units preference
      const savedUnits = localStorage.getItem('units') || 'metric';
      state.units = savedUnits;
      // apply UI
      applyUnitUI(savedUnits);

      // ensure underlying radios reflect savedUnits
      if (savedUnits === 'metric') inputMetric.checked = true; else inputImperial.checked = true;

      // render recent & fetch last city
      renderRecent();
      const last = localStorage.getItem('lastCity') || 'Surat, IN';
      fetchWeatherByCity(last).catch(()=>{});
    })();
  </script>
</body>
</html>
