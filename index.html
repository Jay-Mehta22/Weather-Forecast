<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weather Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body{font-family:Inter,system-ui,Segoe UI,Roboto,sans-serif;background:#0b1220;color:#e9eef7}
    .glass{background:rgba(255,255,255,0.06);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,0.08);border-radius:16px}
    .loader{width:22px;height:22px;border:3px solid rgba(255,255,255,.2);border-top-color:#fff;border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .forecast-item{min-width:140px}
    .icon{width:64px;height:64px}
    a, a:visited{color:#9ec5ff}
  </style>
</head>
<body>
  <div class="container py-4">
    <header class="d-flex align-items-center justify-content-between mb-3">
      <h1 class="h3 fw-bold m-0">Weather Dashboard</h1>
      <div class="d-flex gap-2">
        <button id="geoBtn" class="btn btn-outline-light btn-sm">Use My Location</button>
        <div class="btn-group" role="group" aria-label="Units">
          <input type="radio" class="btn-check" name="units" id="unitMetric" autocomplete="off" checked>
          <label class="btn btn-outline-light btn-sm" for="unitMetric">°C</label>
          <input type="radio" class="btn-check" name="units" id="unitImperial" autocomplete="off">
          <label class="btn btn-outline-light btn-sm" for="unitImperial">°F</label>
        </div>
      </div>
    </header>

    <section class="glass p-3 mb-3">
      <form id="searchForm" class="row g-2 align-items-center">
        <div class="col-sm-8 col-md-9">
          <input id="cityInput" type="text" class="form-control form-control-lg" placeholder="Search city (e.g., Surat)" required>
        </div>
        <div class="col-sm-4 col-md-3 d-grid">
          <button class="btn btn-light btn-lg" type="submit">Search</button>
        </div>
      </form>
      <div id="status" class="small mt-2 text-warning"></div>
    </section>

    <section id="current" class="glass p-4 mb-3 d-none">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h2 id="cityName" class="h4 fw-bold mb-1">—</h2>
          <div id="dateStr" class="text-secondary">—</div>
        </div>
        <img id="currIcon" class="icon" alt="icon" />
      </div>
      <div class="display-5 fw-bold my-2" id="temp">—</div>
      <div id="desc" class="text-capitalize">—</div>
      <div class="row g-3 mt-2">
        <div class="col-6 col-md-3"><div class="glass p-2">Humidity: <span id="humidity">—</span>%</div></div>
        <div class="col-6 col-md-3"><div class="glass p-2">Wind: <span id="wind">—</span></div></div>
        <div class="col-6 col-md-3"><div class="glass p-2">Feels like: <span id="feels">—</span></div></div>
        <div class="col-6 col-md-3"><div class="glass p-2">Pressure: <span id="pressure">—</span> hPa</div></div>
      </div>
    </section>

    <section id="forecast" class="glass p-3 mb-3 d-none">
      <h3 class="h5">5‑Day Forecast</h3>
      <div id="forecastRow" class="d-flex gap-3 overflow-auto pt-2"></div>
    </section>

    <footer class="text-center text-secondary small mt-4">
      Built with <a href="https://openweathermap.org/" target="_blank" rel="noreferrer">OpenWeatherMap</a>. Deploy easily on Azure Static Web Apps.
    </footer>
  </div>

  <script>
    // ====== CONFIG ======
    const API_KEY = "c25334379a5aab71bcd1bd2927502c52"; // Get a free key
    const state = { units: 'metric' };

    // ====== HELPERS ======
    const $ = (sel) => document.querySelector(sel);
    const statusEl = $('#status');
    const showStatus = (msg, loading=false) => {
      statusEl.innerHTML = loading ? `<span class="loader me-2"></span>${msg}` : msg;
    };
    const iconUrl = (code) => `https://openweathermap.org/img/wn/${code}@2x.png`;
    const fmtTemp = (t) => `${Math.round(t)}°${state.units === 'metric' ? 'C' : 'F'}`;
    const fmtWind = (s) => state.units === 'metric' ? `${(s*3.6).toFixed(1)} km/h` : `${s.toFixed(1)} mph`;

    // ====== API CALLS ======
    async function fetchWeatherByCity(city){
      const base = `https://api.openweathermap.org/data/2.5/`;
      const q = encodeURIComponent(city);
      const u = state.units;
      const currUrl = `${base}weather?q=${q}&appid=${API_KEY}&units=${u}`;
      const foreUrl = `${base}forecast?q=${q}&appid=${API_KEY}&units=${u}`;
      showStatus('Fetching weather…', true);
      const [currRes, foreRes] = await Promise.all([fetch(currUrl), fetch(foreUrl)]);
      if(!currRes.ok) throw new Error('City not found');
      const curr = await currRes.json();
      const fore = await foreRes.json();
      localStorage.setItem('lastCity', city);
      renderCurrent(curr);
      renderForecast(fore);
      showStatus('');
    }

    async function fetchWeatherByCoords(lat, lon){
      const base = `https://api.openweathermap.org/data/2.5/`;
      const u = state.units;
      const currUrl = `${base}weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=${u}`;
      const foreUrl = `${base}forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=${u}`;
      showStatus('Fetching weather for your location…', true);
      const [currRes, foreRes] = await Promise.all([fetch(currUrl), fetch(foreUrl)]);
      if(!currRes.ok) throw new Error('Could not get location weather');
      const curr = await currRes.json();
      const fore = await foreRes.json();
      localStorage.setItem('lastCity', curr.name);
      renderCurrent(curr);
      renderForecast(fore);
      showStatus('');
    }

    // ====== RENDER ======
    function renderCurrent(d){
      $('#current').classList.remove('d-none');
      $('#cityName').textContent = `${d.name}, ${d.sys.country}`;
      $('#dateStr').textContent = new Date(d.dt*1000).toLocaleString();
      $('#currIcon').src = iconUrl(d.weather[0].icon);
      $('#currIcon').alt = d.weather[0].description;
      $('#temp').textContent = fmtTemp(d.main.temp);
      $('#desc').textContent = d.weather[0].description;
      $('#humidity').textContent = d.main.humidity;
      $('#wind').textContent = fmtWind(d.wind.speed);
      $('#feels').textContent = fmtTemp(d.main.feels_like);
      $('#pressure').textContent = d.main.pressure;
    }

    function renderForecast(f){
      $('#forecast').classList.remove('d-none');
      const row = $('#forecastRow');
      row.innerHTML = '';
      // group by day at 12:00:00
      const items = f.list.filter(x=>x.dt_txt.includes('12:00:00'));
      items.forEach((x)=>{
        const el = document.createElement('div');
        el.className = 'forecast-item glass p-2 text-center';
        el.innerHTML = `
          <div class="fw-semibold">${new Date(x.dt*1000).toLocaleDateString(undefined,{weekday:'short', month:'short', day:'numeric'})}</div>
          <img class="icon" src="${iconUrl(x.weather[0].icon)}" alt="${x.weather[0].description}">
          <div class="small text-capitalize">${x.weather[0].description}</div>
          <div class="fw-bold">${fmtTemp(x.main.temp)}</div>
          <div class="small">H: ${fmtTemp(x.main.temp_max)} · L: ${fmtTemp(x.main.temp_min)}</div>
        `;
        row.appendChild(el);
      });
    }

    // ====== EVENTS ======
    $('#searchForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const city = $('#cityInput').value.trim();
      if(!city) return;
      fetchWeatherByCity(city).catch(err=>{
        console.error(err);
        showStatus(err.message || 'Something went wrong');
      });
    });

    $('#geoBtn').addEventListener('click', ()=>{
      if(!navigator.geolocation){
        showStatus('Geolocation not supported in this browser');
        return;
      }
      navigator.geolocation.getCurrentPosition(
        (pos)=>{
          const {latitude, longitude} = pos.coords;
          fetchWeatherByCoords(latitude, longitude).catch(err=>{
            console.error(err);
            showStatus(err.message || 'Something went wrong');
          });
        },
        (err)=>{
          showStatus('Location permission denied');
        }
      );
    });

    document.getElementById('unitMetric').addEventListener('change', ()=>{
      state.units = 'metric';
      const last = localStorage.getItem('lastCity');
      if(last) fetchWeatherByCity(last).catch(()=>{});
    });
    document.getElementById('unitImperial').addEventListener('change', ()=>{
      state.units = 'imperial';
      const last = localStorage.getItem('lastCity');
      if(last) fetchWeatherByCity(last).catch(()=>{});
    });

    // ====== INIT ======
    (function init(){
      const last = localStorage.getItem('lastCity') || 'Surat';
      fetchWeatherByCity(last).catch(()=>{});
    })();
  </script>
</body>
</html>